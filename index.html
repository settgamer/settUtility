<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>settUtility</title>

    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/gh/ekmas/cs16.css@main/css/cs16.min.css"
    />

    <style>
      body,
      pre,
      code {
        font-family: "ArialPixel", monospace;
      }

      .centered {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        width: 100%;
      }

      .console-container {
        width: 90%;
        max-width: 900px;
      }

      .code-block {
        overflow-x: hidden;
        margin-bottom: 15px;
      }

      .code-block .inner {
        position: relative;
      }

      .code-block .inner pre {
        background-color: #3e4637;
        border: 1px solid;
        border-color: #292c21 #8c9284 #8c9284 #292c21;
        padding: 10px;
        color: #d6ffd6;
        font-size: 14px;
        line-height: 1.25; /* espaçamento menor */
        min-height: 220px;
      }

      .code-block .inner pre code {
        white-space: pre-wrap;
      }

      .prompt {
        color: #d6ffd6;
      }
      .separator {
        color: #5a6352;
      }
      .info {
        color: #ffcc00;
      }
      .success {
        color: #90ee90;
      }
      .cmd {
        color: #87cefa;
      }
      .wait {
        color: #ffb347;
      }

      .cursor {
        display: inline-block;
        width: 8px;
        animation: blink 1s step-start infinite;
      }

      @keyframes blink {
        50% {
          opacity: 0;
        }
      }

      /* Spinner old school “digitalizado” (feito com blocos) */
      .spinner {
        display: inline-block;
        width: 14px;
        height: 14px;
        margin-left: 6px;
        position: relative;
      }

      .spinner-dot {
        position: absolute;
        width: 2px;
        height: 2px;
        background: #d6ffd6;
        image-rendering: pixelated;
      }

      /* 8 pontos em volta (tipo loader antigo) */
      .spinner-dot:nth-child(1) {
        top: 0;
        left: 6px;
      }
      .spinner-dot:nth-child(2) {
        top: 2px;
        left: 10px;
      }
      .spinner-dot:nth-child(3) {
        top: 6px;
        left: 12px;
      }
      .spinner-dot:nth-child(4) {
        top: 10px;
        left: 10px;
      }
      .spinner-dot:nth-child(5) {
        top: 12px;
        left: 6px;
      }
      .spinner-dot:nth-child(6) {
        top: 10px;
        left: 2px;
      }
      .spinner-dot:nth-child(7) {
        top: 6px;
        left: 0;
      }
      .spinner-dot:nth-child(8) {
        top: 2px;
        left: 2px;
      }

      .spinner {
        animation: spin-old 0.8s steps(8) infinite;
      }

      @keyframes spin-old {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      a {
        color: #87cefa;
        text-decoration: underline;
      }

      a:hover {
        color: #90ee90;
      }

      h1 {
        text-align: center;
        margin-bottom: 20px;
        color: #d6ffd6;
      }
    </style>
  </head>

  <body>
    <div class="centered">
      <h1>settUtility</h1>

      <div class="console-container">
        <div class="code-block">
          <div class="inner">
            <pre><code id="console"></code></pre>
          </div>
        </div>
      </div>
    </div>

    <script>
      const downloadUrl =
        "https://github.com/settgamer/settUtility/raw/main/settUtility.zip";

      // Script das linhas, em ordem
      const scriptLines = [
        { text: ">>> settUtility", className: "prompt" },
        { text: "", className: "" },
        { text: "[INFO] Initializing download..", className: "info" },
        { text: "", className: "" },
        { text: "[OK] settUtility.zip found.", className: "success" },
        {
          text: "[OK] Executing: start_download(settUtility.zip)..",
          className: "success",
        },
        {
          text: "[CMD] Executing: start_download(settUtility.zip)..",
          className: "cmd",
          withSpinner: true, // spinner ao lado desta linha
        },
        { text: "", className: "" },
        {
          text: "[WAIT] If download doesn't start, click here:",
          className: "wait",
        },
        { text: "link", isLink: true },
        { text: "", className: "" },
      ];

      const consoleEl = document.getElementById("console");
      let downloadStarted = false;

      function appendSpan(className = "") {
        const span = document.createElement("span");
        if (className) span.className = className;
        consoleEl.appendChild(span);
        return span;
      }

      // digita uma linha letra por letra
      function typeLine(lineDef, delay) {
        return new Promise((resolve) => {
          setTimeout(() => {
            const { text, className, withSpinner, isLink } = lineDef;

            // linha com link
            if (isLink) {
              const line = appendSpan("");
              line.innerHTML =
                '[WAIT] <a href="' + downloadUrl + '">settUtility.zip</a>';
              consoleEl.appendChild(document.createTextNode("\n"));
              return resolve();
            }

            const line = appendSpan(className);

            let i = 0;
            const interval = setInterval(() => {
              line.textContent += text.charAt(i);
              i++;

              if (i >= text.length) {
                clearInterval(interval);

                // se essa linha tem spinner, adiciona ao lado e inicia download
                if (withSpinner) {
                  const spinner = document.createElement("span");
                  spinner.className = "spinner";
                  // cria dots pixelados
                  for (let d = 0; d < 8; d++) {
                    const dot = document.createElement("span");
                    dot.className = "spinner-dot";
                    spinner.appendChild(dot);
                  }
                  line.appendChild(spinner);

                  if (!downloadStarted) {
                    downloadStarted = true;
                    // inicia o download aqui
                    window.location.href = downloadUrl;

                    // remove spinner depois de 7 segundos
                    setTimeout(() => {
                      spinner.remove();
                    }, 4000);
                  }
                }

                consoleEl.appendChild(document.createTextNode("\n"));
                resolve();
              }
            }, 25); // velocidade da digitação
          }, delay);
        });
      }

      async function runConsole() {
        let currentDelay = 0;

        for (const line of scriptLines) {
          await typeLine(line, currentDelay);
          currentDelay += 90; // delay pequeno entre linhas
        }

        // cursor piscando no final
        const cursorLine = appendSpan("");
        const cursor = document.createElement("span");
        cursor.className = "cursor";
        cursor.textContent = "_";
        cursorLine.appendChild(cursor);
      }

      runConsole();
    </script>
  </body>
</html>
